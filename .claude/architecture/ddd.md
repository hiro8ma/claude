# ドメイン駆動設計 (DDD)

## ドメインモデル

```
ドメイン → ドメインモデル → ソフトウェアモデル → オブジェクトモデル
  反映        表現            実装
```

1. **ドメインモデル**: ドメインを反映したもの
2. **ソフトウェアモデル**: ドメインモデルを表現したもの
3. **オブジェクトモデル**: ソフトウェアモデルを実装したもの

### ドメインモデル貧血症

避けるべき状態:

- 値を保持するだけのオブジェクト
- 利用側にほとんどのロジックがある
- ドメインオブジェクトの目的が不明

## ドメイン

- ユーザーがプログラムを適用する対象領域
- 組織が行う事業とそれを取り巻く世界
- 業務に関連する領域

### サブドメイン

| 種類 | 説明 |
|------|------|
| コアドメイン | 事業成功に不可欠 |
| 支援サブドメイン | コアを支援 |
| 汎用サブドメイン | 一般的な機能 |

## 境界づけられたコンテキスト

単一の境界コンテキストは単一のチームが受け持つ。

### コンテキスト間の関係

| パターン | 説明 |
|----------|------|
| 共有カーネル | ドメインモデルの一部を共有 |
| 顧客/供給者 | 2チーム間の関係を確立 |
| 順応者 | 相手のコンテキストに従う |
| 腐敗防止層 | 隔離するためのレイヤを作成 |
| 別々の道 | 2つのコンテキストのつながりを持たない |
| 公開ホストサービス | 共有プロトコルを公開 |
| 公表された言語 | 標準化されたプロトコルを利用 |
| 巨大な泥団子 | ドメインモデリングを諦め、隔離 |

## マイクロサービス

境界コンテキストを基に切り離されたサービスは、**集約が複数にまたがるAPIは公開しない**。

## スキーマ定義

境界コンテキスト内で一意の値オブジェクトは共通スキーマ（`global`パッケージ等）で定義。

```protobuf
// 例: Protocol Buffers
syntax = "proto3";

package global.v1;

enum StateType {
  STATE_TYPE_UNSPECIFIED = 0;
  STATE_TYPE_ACTIVE = 1;
}
```

各言語で生成されたコードを利用し、コンテキスト間で一貫性を保つ。
